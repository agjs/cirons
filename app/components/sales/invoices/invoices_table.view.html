<div class="object-tabe-heading">

    <div class="ui grid stackable">
        <div class="column eight wide">
            <h2>Invoices</h2>
            <button type="button" class="ui button small teal labeled icon" ui-sref="invoices.create">
                <i class="icon plus"></i>
                Add new
            </button>
        </div>
        <div class="column eight wide">
            <div class="ui action input pull-right left icon">
                <i class="icon search"></i>

                <input type="text" placeholder="Search Invoices..." ng-model="search.contact.name">

                <div class="ui floating dropdown labeled icon button" sui-dropdown>
                    <i class="filter icon"></i>
                    <span class="text">Filter Invoices</span>
                    <div class="menu">
                        <div class="item" ng-click="search = {}">
                            <div class="ui empty circular black label"></div>
                            Show All
                        </div>
                        <div class="header">
                          <i class="tags icon"></i>
                          Invoice Status
                        </div>
                        <div class="scrolling menu">
                            <div class="item" ng-repeat="status in statuses" ng-click="search.step = status.step">
                                <div ng-class="status.color" class="ui empty circular label"></div>
                                {{status.label}}
                            </div>
                        </div>
                        <div class="header">
                          <i class="tags icon"></i>
                          Invoice Status
                        </div>
                        <div class="scrolling menu">
                            <div class="item" ng-click="search.step = '!paid'">
                                Unpaid
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

</div>
<div class="table-responsive">
<table class="ui table celled unstackable object-table">
    <thead>
		<tr>
			<th width="1"></th>
			<th>NO #</th>
			<th>Customer</th>
			<th>Status</th>
			<th>Order Status</th>
			<th class="right">Invoice Sum</th>
			<th>Invoice Date</th>
			<th>Actions</th>
		</tr>
	</thead>
    <tbody>
        <tr ng-repeat-start="invoice in filtered() | filter: search | orderBy: orderByKey : orderByReverse track by $index" ng-show=" ($index == 0 || lastDate.getFullYear().toString()+lastDate.getMonth().toString() != invoice.date.getFullYear().toString()+invoice.date.getMonth().toString() ? newLastDate(invoice.date) : false )">
            <td class="table-separator" colspan="8">
                {{ invoice.date | date : 'MMMM yyyy' }}
            </td>
        </tr>
        <tr ng-repeat-end>
			<td>
                <input type="checkbox">
            </td>
			<td ui-sref="invoices.item.general({id: invoice.id, invoice: invoice})">
                <span ng-if="invoice.invoice_no">{{invoice.invoice_no}}</span>
                <a ng-if="!invoice.invoice_no" class="ui tag label">Draft</a>
            </td>
			<td ui-sref="invoices.item.general({id: invoice.id, invoice: invoice})">{{invoice.contact.name}}</td>
			<td ui-sref="invoices.item.general({id: invoice.id, invoice: invoice})">
                <cirons-status-badge
                    model="Invoice"
                    step="{{invoice.step}}"
                ></cirons-status-badge>
            </td>
			<td ui-sref="invoices.item.general({id: invoice.id, invoice: invoice})">
                <cirons-status-badge
                    ng-if="invoice.order"
                    model="Order"
                    step="{{invoice.order.step}}"
                ></cirons-status-badge>
            </td>
			<td ui-sref="invoices.item.general({id: invoice.id, invoice: invoice})" class="right">{{invoice.grand_total | number: 2}} {{invoice.currency}}</td>
			<td ui-sref="invoices.item.general({id: invoice.id, invoice: invoice})">{{invoice.date | date: 'yyyy-MM-dd'}}</td>
			<td>
                <div sui-dropdown sui-action="nothing" class="ui labeled icon top right mini pointing dropdown teal button">
                    <i class="icon download cloud"></i>
                    <span class="text">Download</span>
                    <div class="menu">
                        <a ng-show="invoice.step !== 'draft'" href="http://system.cirons.com/{{$root.client}}/api/v1/invoices/{{invoice.id}}/pdf?token={{$root.token}}" class="item"><i class="icon teal file outline pdf"></i> Invoice PDF</a>
                        <a href="http://system.cirons.com/{{$root.client}}/api/v1/orders/{{invoice.order.id}}/pdf?token={{$root.token}}" ng-if="invoice.order" class="item"><i class="icon blue file outline pdf"></i> Order Note</a>
                        <a href="http://system.cirons.com/{{$root.client}}/api/v1/orders/{{invoice.order.id}}/packing_list?token={{$root.token}}" ng-if="invoice.order" class="item"><i class="icon brown file outline pdf"></i> Packing List</a>
                    </div>
                </div>

            </td>
		</tr>
    </tbody>
    <tfoot>
        <tr>
            <th width="1"></th>
            <th>ID #</th>
            <th>Customer</th>
            <th>Status</th>
            <th>Order Status</th>
            <th class="right">Invoice Sum</th>
            <th>Invoice Date</th>
            <th>Actions</th>
        </tr>
    </tfoot>
</table>
</div>
