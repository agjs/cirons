<div class="open-view">

  <div class="open-view-content">
    <form class="ui form" ng-submit="addPurchaseOrder()">
      <div class="toolbar">

        <button class="ui dropdown button icon labeled positive">
          <i class="check icon"></i>
          Save and create
        </button>
      </div>

      <div class="seperator"></div>

      <div class="two fields">

          <div class="field">
              <h4 class="ui horizontal divider header">
                <i class="shipping icon"></i>
                Select Supplier
              </h4>
              <label>Search supplier</label>
              <input ng-model="purchaseOrder.supplier" type="text" uib-typeahead="item as item.company_name for item in suppliers | filter:{company_name:$viewValue}" placeholder="Search supplier">
          </div>

          <div class="field">
              <h4 class="ui horizontal divider header">
                <i class="shipping icon"></i>
                Delivery Address
              </h4>
              <div>
                  <cirons-address-selector
                    address="purchaseOrder.delivery_address"
                  ></cirons-address-selector>
              </div>
          </div>
      </div>

      <div class="seperator"></div>

      <h4 class="ui horizontal divider header">
      	<i class="tag icon"></i>
      	Purchase Description
      </h4>

      <table class="ui table celled compact">
          <thead>
              <tr>
                  <th>Product</th>
                  <th>Ordered</th>
                  <th>Shipped</th>
                  <th>Unit</th>
                  <th>VAT</th>
                  <th>Unit Price</th>
                  <th>Row Total</th>
              </tr>
          </thead>
          <tbody>
              <tr ng-repeat="row in purchaseOrder.order_rows">
                  <td>{{row.product.name}}</td>
                  <td>
                      <input ng-blur="updateRow(row)" type="text" ng-model="row.ordered">
                  </td>
                  <td>
                      <input ng-blur="updateRow(row)" type="text" ng-model="row.q">
                  </td>
                  <td>
                      <select ng-change="updateRow(row)" ng-model="row.q_type">
      					<option value="0">units</option>
      					<option value="1">litre</option>
      					<option value="2">hour</option>
      					<option value="3">tonne</option>
      					<option value="4">mm</option>
      					<option value="5">kwh</option>
      					<option value="6">m²</option>
      					<option value="7">metre</option>
      					<option value="8">month</option>
      					<option value="9">km</option>
      					<option value="10">m³</option>
      					<option value="11">kg</option>
      					<option value="12">day</option>
      					<option value="13">gram</option>
      				</select>
                  </td>
                  <td>
                      <select ng-change="updateRow(row)" ng-model="row.vat_id">
      					<option ng-repeat="rule in settings.vat_rules" value="{{rule.id}}">{{rule.percent}}%</option>
      				</select>
                  </td>
                  <td>
                      <input ng-blur="updateRow(row)" type="text" ng-model="row.price">
                  </td>
                  <td>
                      {{row.price * row.q | number : 2}}
                  </td>
              </tr>
              <tr>
                  <th colspan="7">
                      Add new row
                  </th>
              </tr>
              <tr>
                  <td>
                      <input ng-model="newrow.product" type="text" uib-typeahead="item as item.name for item in products | filter:{name:$viewValue}">
                  </td>
                  <td>
                      <input type="text" ng-model="newrow.ordered">
                  </td>
                  <td>
                      <input type="text" ng-model="newrow.q">
                  </td>
                  <td>
                      <select ng-model="newrow.q_type">
      					<option value="0">units</option>
      					<option value="1">litre</option>
      					<option value="2">hour</option>
      					<option value="3">tonne</option>
      					<option value="4">mm</option>
      					<option value="5">kwh</option>
      					<option value="6">m²</option>
      					<option value="7">metre</option>
      					<option value="8">month</option>
      					<option value="9">km</option>
      					<option value="10">m³</option>
      					<option value="11">kg</option>
      					<option value="12">day</option>
      					<option value="13">gram</option>
      				</select>
                  </td>
                  <td>
                      <select ng-model="newrow.vat_id">
      					<option ng-repeat="rule in settings.vat_rules" value="{{rule.id}}">{{rule.percent}}%</option>
      				</select>
                  </td>
                  <td>
                      <input type="text" ng-model="newrow.price">
                  </td>
                  <td>
                      <button type="button" ng-click="addOrderRow()" class="ui button positive tiny">Add</button>
                  </td>
              </tr>
          </tbody>
          <tfoot>
              <tr>
                  <th colspan="5">
                  </th>
                  <th>
                      Sub Total
                  </th>
                  <th>
                      {{subTotal | number: 2}}
                  </th>
              </tr>
              <tr>
                  <th colspan="5">
                  </th>
                  <th>
                      Total VAT
                  </th>
                  <th>
                      {{totalVAT | number: 2}}
                  </th>
              </tr>
              <tr>
                  <th colspan="5">
                  </th>
                  <th>
                      Grand Total
                  </th>
                  <th>
                      {{grandTotal | number: 2}}
                  </th>
              </tr>
          </tfoot>
      </table>

  </div>
</div>
